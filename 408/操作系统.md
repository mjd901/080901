# 操作系统

## 概述

### 概念、特征、功能

#### 操作系统的概念

计算机系统中的软件通常分为**系统软件**和**应用软件**两大类。

应用软件是指计算机用户利用计算机的软件、硬件资源为某一专门的应用目的开发的软件。例如，科学计算、工程设计、数据处理、事务处理和过程控制等方面的软件，以及文字处理软件、表格处理软件、辅助设计软件和实时处理软件等。

系统软件是计算机系统的一部分，由它支持应用软件的运行。常用的系统软件有**操作系统、语言处理程序、链接程序、诊断程序和数据库管理系统**等。

**操作系统是计算机系统中必不可少的核心系统软件，控制和管理整个计算机系统的硬件和软件资源，是用户和计算机之间的接口。**



#### 操作系统的特征

作为一种系统软件，操作系统有**并发性、共享性、虚拟性、异步性的特征**。

1. **并发性**：在多道程序环境下，并发性是指两个或多个事件在同一时间间隔内发生，即宏观上有多道程序同时执行，**而微观上，在单处理机系统中每一个时刻仅能执行一道程序，是交替进行的**。
2. 共享性：共享指系统中的资源在一个时间段内可被多个并发执行的进程使用。
3. 随机性：也称不确定性，是指操作系统的运行是在一种随机的环境下进行的，充分考虑各种各样的可能性，稳定、高效地控制资源的使用和程序的运行。

> 若一个单处理机系统中有多个进程存在，则这些进程是并发运行的。



#### 操作系统的功能

**从用户和计算机之间的接口的观点来看，操作系统向上层提供的服务：GUI图形化界面、联机命令接口（终端）、脱机命令接口（.bat）、程序接口（编写代码中的系统调用）。**

从控制和管理整个计算机系统的硬件和软件资源的观点来看，操作系统的功能可以分为**进程管理(处理机管理)、存储管理、文件管理、设备管理和作业管理(命令接口)**5大部分。操作系统的5大部分通过相互配合、协调工作，以实现对计算机系统中资源的管理，控制任务的运行。

1. **进程管理**：实质是对处理器管理，主要任务是对进程的控制、同步、通信以及调度。
2. **存储管理**：主要任务是管理计算机内存资源。
3. **文件管理**：主要任务是有效地支持文件的存储、检索和修改等操作。
4. **设备管理**：对所有输入、输出设备的管理。
5. **接口管理**：命令接口、程序接口、图形接口。

从操作系统是计算机系统中必不可少的核心系统软件的观点来看，操作系统是对硬件机器的扩展，把计算机从裸机变为虚拟机。



### 操作系统的发展与分类

#### 操作系统的发展

操作系统从最初20世纪50年代的手工操作阶段，到早期的批处理程序，再到多道批处理系统、分时系统、实时系统，以及后来的个人操作系统、网络操作系统、分布式操作系统、嵌入式操作系统、智能卡操作系统等，经历了较复杂的发展的历程。



#### 操作系统的分类

**按照用户界面的使用环境和功能特征，分为三种：批处理系统、分时系统、实时系统**。

**Linux、UNIX系统属于多任务多用户，分时系统，是网络操作系统。**

##### 1. 批处理系统

用户将作业交给操作员，在收到一定数量的作业后，由操作员把这批作业输入到计算机，最后将结果交给用户。自动化较高，资源利用率高，作业吞吐量大，提高整个系统效率。用户不直接与计算机交互，不适合调试程序。

##### 2. 分时系统

用户通过终端交互式地向系统提出命令，系统接受命令之后，采用时间片轮转方式处理服务请求。把处理机的响应时间分成若干个大小相等(或不相等)的时间单位，称为时间片，每个终端用户获得 CPU，就等于获得一个时间片，该用户程序开始运行，当时间片到(用完)，用户程序暂停运行，等待下一次运行。

特性：多路性:多个用户在同时使用一台计算机。交互性:用户直接干预操作的每一步。独占性:用户感觉不到计算机为他人服务。及时性:系统能对用户提出的请求及时给予响应。

##### 3. 实时系统

实时系统是指系统能及时响应外部事件的请求，在规定的时间内，完成对该事件的处理，并控制所有实时任务协调一致地运行。

第一类：硬实时系统(实时过程控制)，工业控制，军事控制等。

第二类：软实时系统(实时通信和信息处理)，电讯(自动交换)，银行，飞机订票，股市行情等。

特征：多路性、独立性、及时性、交互性和可靠性。



### 操作系统的运行环境

#### 内核态与用户态



#### 中断、异常 



#### 系统调用



### 操作系统体系结构



## 进程管理

### 进程与线程 

#### 进程概念



#### 进程的状态与转换



#### 进程控制



#### 进程组织



#### 进程通信 



##### 共享存储系统



##### 消息传递系统



##### 管道通信



#### 线程概念与多线程模型

### 处理机调度 

#### 调度的基本概念



#### 调度时机、切换与过程



#### 度的基本准则



#### 调度方式



#### 典型调度算法 

##### 先来先服务调度算法



##### 短作业(短进程、短线程)优先调度算法



##### 时间片轮转调度算法



##### 优先级调度算法



##### 高响应比优先调度算法



##### 多级反馈队列调度算法



### 同步与互斥

#### 进程同步的基本概念



#### 实现临界区互斥的基本方法

##### 软件实现方法



##### 硬件实现方法



#### 信号量



#### 管程



#### 经典同步问题

##### 生产者-消费者问题



##### 读者-写者问题



##### 哲学家进餐问题



### 死锁 

#### 死锁的概念

**死锁**：是指多个进程因竞争资源而造成的一种僵局现象，若无外力的作用，这些进程都不能继续执行。死锁进程至少有两个。

死锁的原因：

1. 竞争资源。当系统中供多个进程共享的资源不足以同时满足它们的需求时，引起它们对资源的竞争而产生死锁。
2. 进程推进顺序不合理。进程在运行过程中，请求和释放资源的顺序不当，会导致进程死锁。

**活锁**：是指数据资源释放时间不确定，导致某些事务长时间等待，得不到封锁的机会。

**饥饿**：是指系统没有发生死锁，但某些进程可能会长时间等待，当等待时间给进程推进和响应带来明显影响时，称进程饥饿。



#### 死锁处理策略



#### 死锁预防



#### 死锁避免

##### 系统安全状态



##### 银行家算法



#### 死锁检测和解除



## 内存管理

### 内存管理基础 

#### 内存管理概念 

##### 程序装入与链接

**计算机系统中的存储器可分成两类：内存、外存**。

**处理器可以直接访问内存，但不能直接访问外存**。CPU要通过启动相应的I/0设备后才能使外存与内存交换信息。内存管理是操作系统的重要功能之一，对内存管理的好坏直接影响计算机系统工作性能的高低。

存储系统三要素：容量、速度、成本。



##### 逻辑地址与物理地址空间



##### 内存保护



#### 交换与覆盖



#### 连续分配管理方式



#### 非连续分配管理方式

##### 分页管理方式



##### 分段管理方式



##### 段页式管理方式



### 虚拟内存管理 

#### 虚拟内存基本概念



#### 请求分页管理方式



#### 页面置换算法

##### 最佳置换算法(OPT)



##### 先进先出置换算法(FIFO)



##### 最近最少使用置换算法(LRU)



##### 时钟置换算法(CLOCK)



#### 页面分配策略



#### 工作集



#### 抖动



## 文件管理

### 文件系统基础

#### 文件概念

操作系统必须提供的数据存储、数据处理、数据管理的基本功能，这些功能都是以文件形式进行处理和管理的。文件系统是操作系统的一个重要组成部分。

文件是指存放在存储介质上的已命名的一组相关信息的集合，通常将程序和数据组织成文件。文件中的基本访问单位是位、字节或记录。文件的属性包括文件类型、文件长度、文件的物理位置、文件的存取控制、文件的建立时间。文件是一种抽象机制，它提供了一种把信息保存在存储介质上而且便于以后存取的方法，用户不用关心文件的实现细节。

文件系统是操作系统中统一管理信息资源的一种软件。它管理文件的存储、检索、更新，提供安全可靠的共享和保护手段，并且方便用户使用。从用户的角度，**文件系统实现“按名存取”，通过文件目录查找**，主要关心文件由什么组成，如何命名，如何保护，如何操作等。

对不同的文件进行分类管理，提高系统效率，同时提高文件系统的用户界面友好性。

按文件的用途分类：系统文件、库函数文件、用户文件。

按文件的组织形式分类：普通文件、目录文件、特殊文件。

按文件中的保护方式分类：只读文件、读写文件、可执行文件、无保护文件等。

按照文件的组织结构分类：

- **逻辑结构：无结构的流式文件和有结构的记录式文件。**
- **物理结构：顺序文件、链接文件和索引文件。**



文件目录是指存放文件有关信息的一种数据结构。它包含多条记录，每条记录为一个文件的**文件控制块(FCB)**的有关信息。最简单的记录包含文件名和文件的起始地址，用以建立文件名和存储地址的对应关系。文件目录是文件实现按名存取的重要手段，是文件符号名到文件物理地址之间的一种映射机制。
文件控制块FCB:是文件存在的标志，记录了系统管理文件所需要的全部信息，包括**文件名**、文件号、用户名、文件物理地址、文件长度、记录大小、文件类型、文件属性、共享说明、文件逻辑结构、物理结构、文件的建立时间、最后访问时间、最后修改时间、保存期限、口令等。

**操作系统通过 FCB 文件管理** 

操作系统通过 PCB 进程管理 



Windows系统中，用户A对一个文件有读、写的权限，而A对于这个文件所在的文件夹只有读权限，用户A最终对这个文件将具备读权限。

数字表示不同用户或用户组的权限。第一个数字代表档案拥有者，第二个数字代表群组，第三个数字代表其他。在Linux中我们有三种常用权限：可读、可写以及可执行，用数字表示的话就是：可读=4，可写=2，可执行=1。



文件保护是指避免由于自然灾祸、系统故障、用户使用不当等原因使文件遭到破坏或丢失的现象。文件系统通常采用**建立副本、定时转储、规定文件的存储权限**的方法保护文件。

文件保密是指文件本身不得被未授权的用户访问，即防止他人窃取文件。实现文件保密采用的方法有：隐藏文件目录、设置口令、文件加密。



#### 文件的逻辑结构

 ##### 顺序文件



##### 索引文件



##### 索引顺序文件



#### 目录结构 

##### 文件控制块和索引节点



##### 单级目录结构和两级目录结构



##### 树形目录结构



##### 图形目录结构



#### 文件共享 



#### 文件保护

##### 访问类型



##### 访问控制



### 文件系统实现

#### 文件系统层次结构



#### 目录实现



#### 文件实现



### 磁盘组织与管理 

#### 磁盘的结构



#### 磁盘调度算法



#### 磁盘的管理



## 输入输出(I/O)管理

### I/O 管理概述

#### I/O 控制方式



#### I/O 软件层次结构



### I/O 核心子系统

#### I/O 调度概念



#### 高速缓存与缓冲区



#### 设备分配与回收



#### 假脱机技术